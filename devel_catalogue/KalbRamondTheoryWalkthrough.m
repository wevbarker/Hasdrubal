Print@"OK, so we are going to analyse the Kalb-Ramond theory now. The first step is to load the Hamilcar package.";
<<xAct`Hamilcar`;
Print@"The next step is to disable the dynamical metric, since we are working on Minkowski spacetime.";
$DynamicalMetric=False;
Print@"When we work with Poisson brackets, we smear the operands manually.";
$ManualSmearing=True;
Print@"Next, we need to define a bunch of things based on what we've been told. Firstly we will define the constant symbols in the theory.";
DefConstantSymbol[FirstKineticCoupling,PrintAs->"\[Alpha]"];
Print@"Next we define the canonical fields in the theory. Note that the conjugate momenta are defined automatically alongside the fields.";
DefCanonicalField[TwoFormFieldRank2AntisymmetricPara1p[-a,-b],Antisymmetric[{-a,-b}],FieldSymbol->"\[ScriptCapitalA]0p",MomentumSymbol->"\[CapitalPi]\[ScriptCapitalA]0p"];
DefCanonicalField[TwoFormFieldRank2AntisymmetricPerp1m[-a],FieldSymbol->"\[ScriptCapitalA]1m",MomentumSymbol->"\[CapitalPi]\[ScriptCapitalA]1m"];
Print@"Next we define the multipliers in the theory.";
DefTensor[TwoFormFieldRank2AntisymmetricPara1pLagrangeMultiplier[-a,-b],M3,Antisymmetric[{-a,-b}],PrintAs->"\[Lambda]\[ScriptCapitalA]0p"];
DefTensor[TwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a],M3,PrintAs->"\[Lambda]\[ScriptCapitalA]1m"];
Print@"Now we want to define two smearing functions for each of the canonical fields, whose index structure matches those fields.";
DefTensor[SmearingFTwoFormFieldRank2AntisymmetricPara1pLagrangeMultiplier[-a,-b],M3,Antisymmetric[{-a,-b}],PrintAs->"\[ScriptF]"];
DefTensor[SmearingFTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a],M3,
	PrintAs->"\[ScriptF]"];
DefTensor[SmearingSTwoFormFieldRank2AntisymmetricPara1pLagrangeMultiplier[-a,-b],M3,Antisymmetric[{-a,-b}],PrintAs->"\[ScriptS]"];
DefTensor[SmearingSTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a],M3,
	PrintAs->"\[ScriptS]"];
Print@"Now we define the total Hamiltonian density for the theory.";
TotalHamiltonianDensity=-1/8*(ConjugateMomentumTwoFormFieldRank2AntisymmetricPara1p[-a, -b]*ConjugateMomentumTwoFormFieldRank2AntisymmetricPara1p[a, b])/FirstKineticCoupling + ConjugateMomentumTwoFormFieldRank2AntisymmetricPerp1m[-a]*TwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a] + 2*ConjugateMomentumTwoFormFieldRank2AntisymmetricPara1p[-a, -b]*CD[b][TwoFormFieldRank2AntisymmetricPerp1m[a]] + 4*FirstKineticCoupling*CD[-b][TwoFormFieldRank2AntisymmetricPara1p[-a, -c]]*CD[c][TwoFormFieldRank2AntisymmetricPara1p[a, b]] - 2*FirstKineticCoupling*CD[-c][TwoFormFieldRank2AntisymmetricPara1p[-a, -b]]*CD[c][TwoFormFieldRank2AntisymmetricPara1p[a, b]];
TotalHamiltonianDensity//=Recanonicalize;
TotalHamiltonianDensity//Print;
Print@"The first step is to find all the primary constraints. Having been provided with the total Hamiltonian density, we could recover these by reading them off directly. It is safer, however, to proceed systematically, by taking variations with respect to the multipliers.";
Expr=VarD[TwoFormFieldRank2AntisymmetricPara1pLagrangeMultiplier[-a,-b],CD][TotalHamiltonianDensity];
Expr//=Recanonicalize;
Expr//Print;
Print@"So that is zero, and hence no primary constraint from this field. Now let's check the other one.";
Expr=VarD[TwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a],CD][TotalHamiltonianDensity];
Expr//=Recanonicalize;
Expr//Print;
Print@"Ah, so that is non-zero, and hence there are three primary constraints associated with that multiplier. Let's define a tensor to represent that those constraints.";
DefTensor[PrimaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],M3,PrintAs->"\[Phi]\[ScriptCapitalA]0p"];
FromPrimaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier=MakeRule[{PrimaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],Evaluate@Expr},MetricOn->All,ContractMetrics->True];
FromPrimaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier//PrependTotalFrom;
Print@"So, the theory has three primary constraints in total. Now we need to check whether these constraints are preserved in time. We smear them with appropriate smearing functions before taking Poisson brackets with the total Hamiltonian. To compute the secondaries as (potentially indexed) tensor expressions, we then take variations with respect to the smearing functions.";
Expr=PoissonBracket[SmearingSTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a]*PrimaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],TotalHamiltonianDensity,Parallel->True];
Expr//=VarD[SmearingSTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a],CD][#]&;
Expr//=Recanonicalize;
Expr//Print;
Print@"Ah, so the velocities of these primaries don't vanish identically, nor is it equal to a combination of any other constraints (there are none), nor is it equal to an expression which can be set to zero for appropriate values of the multipliers. Hence we have found some secondary constraints. Specifically, we have found two secondary constraints, because the expression is the spatial divergence of a two-form in three dimensions, which is the curl of a vector (i.e. the vector to which the two-form is dual). let's define a tensor to represent those secondary constraints.";
DefTensor[SecondaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],M3,PrintAs->"\[Chi]\[ScriptCapitalA]0p"];
FromSecondaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier=MakeRule[{SecondaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],Evaluate@Expr},MetricOn->All,ContractMetrics->True];
FromSecondaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier//PrependTotalFrom;
Print@"We now need to check whether the secondaries are preserved in time. We proceed as before, smearing with an appropriate smearing function and taking the Poisson bracket with the total Hamiltonian, before taking variations with respect to the smearing function to recover the indexed tensor expression.";
Expr=PoissonBracket[SmearingSTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a]*SecondaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],TotalHamiltonianDensity,Parallel->True];
Expr//=VarD[SmearingSTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a],CD][#]&;
Expr//=Recanonicalize;
Expr//Print;
Print@"Ah, so the velocities of the secondaries vanish identically, and hence there are no further constraints, and we have found all the constraints in the theory. Now we need to classify the constraints into first and second class. To do this, we need to compute the Poisson brackets between all pairs of constraints.";
Expr=PoissonBracket[SmearingFTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a]*PrimaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],SmearingSTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[-a]*SecondaryConstraintTwoFormFieldRank2AntisymmetricPerp1mLagrangeMultiplier[a],Parallel->True];
Expr//Print;
Print@"Ah, so the Poisson bracket between the primaries and secondaries is vanishing. This means that both constraints are first class. We have now found and classified all the constraints in the theory. To summarise, the theory has five constraints in total: three primary and two secondary. Both constraints are first class. The total number of canonical degrees of freedom in the theory is 2*(3+3), where the 2 is from the field-momentum pairs, and the (3+3) is from the three-dimensional vector and three-dimensional two-form components of the four-dimensional two-form field. From this we subtract 2*3 degrees of freedom for the primary first class constraints, and another 2*2 degrees of freedom for the secondary first-class constraint, leaving us with 2*(3+3)-2*3-2*2=2 canonical degrees of freedom, or equivalently 1 physical degrees of freedom.";
Quit[];
